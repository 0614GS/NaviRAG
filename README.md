# ğŸš€ NaviRAGï¼šå±‚çº§æ¨ç†æ£€ç´¢å¢å¼ºç”Ÿæˆç³»ç»Ÿ

[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/)

ä¸€ä¸ªåŸºäºæ–‡æ¡£å±‚çº§ç»“æ„å’Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ¨ç†çš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿï¼Œæ‘’å¼ƒä¼ ç»Ÿå‘é‡åµŒå…¥ï¼Œå‘Šåˆ«è¯­ä¹‰æ¨¡ç³Šï¼Œå®ç°å·¥ä¸šçº§æ–‡æ¡£æ£€ç´¢ç²¾åº¦ã€‚

## ğŸ’¡ æ ¸å¿ƒè®¾è®¡å“²å­¦

æœ¬é¡¹ç›®æ‘’å¼ƒäº†ä¼ ç»Ÿçš„"åˆ‡ç‰‡ â†’ å‘é‡åŒ– â†’ ç›¸ä¼¼åº¦åŒ¹é…"æµç¨‹ï¼Œé‡‡ç”¨ **æ ‘çŠ¶æ¨ç†** è·¯å¾„ï¼š

* **ç»“æ„æ„ŸçŸ¥ç´¢å¼•**ï¼šè‡ªåŠ¨è§£æ Markdown H1-H6 å±‚çº§ï¼Œä¿ç•™æ–‡æ¡£è¡€ç»Ÿå’Œé€»è¾‘å…³è”ã€‚
* **è‡ªåº•å‘ä¸Šåˆæˆ**ï¼šèŠ‚ç‚¹æ‘˜è¦ä»åº•éƒ¨å‘ä¸Šæ±‡èšã€‚å­èŠ‚ç‚¹å…³é”®è¯æ”¯æ’‘çˆ¶èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹æ‘˜è¦æµ“ç¼©å­èŠ‚ç‚¹ï¼Œå½¢æˆå…¨æ–¹ä½ã€å¤šç»´åº¦çš„å¯¼èˆªæ ‘ã€‚
* **å…¨å±€åˆ°å±€éƒ¨è·¯ç”±**ï¼š
  1. é€šè¿‡ `global_index.json` ç¡®å®šæ–‡æ¡£èŒƒå›´ã€‚
  2. é€šè¿‡ç²¾ç®€çš„ `doc_nav_tree` å¯¼èˆªåˆ°å…·ä½“çš„ `node_id`ã€‚
  3. ä» `node_content_store` æå–åŸå­çº§æ­£æ–‡ã€‚
* **æ™ºèƒ½å¯¹è¯ Agent**ï¼šåŸºäº LangChain Agent æ¡†æ¶ï¼Œæ•´åˆæœ¬åœ°æ–‡æ¡£æ£€ç´¢å·¥å…·ï¼ˆsearch_local_docsï¼‰å’Œå¤–éƒ¨ MCP å®¢æˆ·ç«¯å·¥å…·ï¼Œå®ç°å¤šå·¥å…·åä½œçš„å¯¹è¯ç³»ç»Ÿã€‚Agent èƒ½å¤Ÿç†è§£ç”¨æˆ·æŸ¥è¯¢ï¼Œè‡ªåŠ¨è°ƒç”¨æ£€ç´¢å·¥ä½œæµè·å–ç›¸å…³æ–‡æ¡£ç‰‡æ®µï¼Œå¹¶ç»“åˆå…¶ä»–å·¥å…·ç”Ÿæˆå‡†ç¡®å›ç­”ã€‚

## ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§

- âœ… **Markdown ç»“æ„åŒ–è§£æ**ï¼šè‡ªåŠ¨æ„å»ºæ ‘çŠ¶ç»“æ„ï¼Œæ”¯æŒä»£ç å—è¿‡æ»¤ï¼Œé˜²æ­¢å†…å®¹å¹²æ‰°ã€‚
- âœ… **åŒå±‚ç´¢å¼•æœºåˆ¶**ï¼š
  - **å…¨å±€ç´¢å¼•**ï¼šè·¨æ–‡æ¡£å¯¼èˆªï¼Œå¿«é€Ÿå®šä½ç›¸å…³æ–‡ä»¶ã€‚
  - **æœ¬åœ°å¯¼èˆªæ ‘**ï¼šæ–‡æ¡£å†…å¯¼èˆªï¼ŒLLM åƒè¯»ç›®å½•ä¸€æ ·ç²¾å‡†å®šä½ç« èŠ‚ã€‚
- âœ… **åŸå­çº§å­˜å‚¨**ï¼šå¯¼èˆªæ ‘ä¸æ­£æ–‡å†…å®¹è§£è€¦ï¼Œç´¢å¼•æå…¶è½»é‡ï¼ˆToken æ¶ˆè€—é™ä½ 80%ï¼‰ã€‚
- âœ… **Pydantic å¼ºåˆ¶ Schema**ï¼šæ‰€æœ‰ LLM è¾“å‡ºå‡ç»è¿‡æ ¼å¼éªŒè¯ï¼Œç¡®ä¿ Summary ä¸ Keywords çš„ç¨³å®šæ€§ã€‚
- âœ… **é«˜æ€§èƒ½å¹¶å‘å¤„ç†**ï¼šé‡‡ç”¨å¼‚æ­¥ IO (`asyncio.gather`) å®ç°å¤šæ–‡æ¡£ã€å¤šèŠ‚ç‚¹çš„å¹¶è¡Œç´¢å¼•æ„å»ºã€‚
- âœ… **å¯¹è¯ Agent**ï¼šé›†æˆæ£€ç´¢å·¥å…·ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€å¯¹è¯ï¼Œç»“åˆæœ¬åœ°æ–‡æ¡£æ£€ç´¢å’Œå¤–éƒ¨ MCP å·¥å…·ã€‚

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.10+
- ä¾èµ–åŒ…è§ `requirements.txt`

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè®¾ç½®

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»ç¯å¢ƒ
# Windows
venv\Scripts\activate
# Unix/MacOS
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. æ„å»ºæ–‡æ¡£ç´¢å¼•

å°†è¦æ„å»ºç´¢å¼•çš„ Markdown æ–‡æ¡£æ”¾å…¥ `/data/input` æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œï¼š

```bash
python data/md2tree.py
```

ç³»ç»Ÿå°†è‡ªåŠ¨æ‰«ææ–‡æ¡£ï¼Œç”Ÿæˆå…¨å±€ IDï¼Œå¹¶æ„å»ºå¤šå±‚çº§æ‘˜è¦ã€‚

### 3. ä½¿ç”¨æ£€ç´¢å™¨

```python
# è¾“å…¥ï¼šstr = query
# è¾“å‡ºï¼šlist = [node_1, node_2, ...]

# æ£€ç´¢å™¨é€»è¾‘ï¼š
# 1. åŠ è½½å…¨å±€ç´¢å¼•
# 2. LLM å†³ç­–ç›®æ ‡æ–‡æ¡£ (Doc Routing)
# 3. åŠ è½½ç›®æ ‡æ–‡æ¡£çš„è½»é‡çº§ Tree
# 4. LLM å†³ç­–ç›®æ ‡èŠ‚ç‚¹ (Node Routing)
# 5. LLM è¯„ä»·èŠ‚ç‚¹å†…å®¹ (Node Grading)
# 6. è¿”å›ç›¸å…³èŠ‚ç‚¹çš„å†…å®¹
```

### 4. ä½¿ç”¨å¯¹è¯ Agent

Agent æ•´åˆäº†æœ¬åœ°æ–‡æ¡£æ£€ç´¢å’Œå¤–éƒ¨å·¥å…·ï¼Œæ”¯æŒå¯¹è¯å¼æŸ¥è¯¢ï¼š

```python
from core.agent import agent

# Agent å·²é¢„æ„å»ºï¼ŒåŒ…å«æœ¬åœ°æ£€ç´¢å·¥å…·å’Œ MCP å®¢æˆ·ç«¯å·¥å…·
response = agent.invoke("å¦‚ä½•ä½¿ç”¨é•¿æœŸè®°å¿†ï¼Ÿ")
print(response)
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ input/              # åŸå§‹ Markdown æ–‡æ¡£
â”‚   â”œâ”€â”€ output/             # æ–‡æ¡£å¯¼èˆªæ ‘ç´¢å¼• (doc_id.json ä»¥åŠ global_index.json)
â”‚   â”œâ”€â”€ fs_store/
â”‚   â”‚   â”œâ”€â”€ docs/           # æ–‡æ¡£æ ‘å­˜å‚¨ (doc_id -> tree)
â”‚   â”‚   â””â”€â”€ nodes/          # åŸå­æ­£æ–‡å­˜å‚¨ (node_id -> text)
â”‚   â””â”€â”€ storage.py          # åŸºäº Key-Value çš„å­˜å‚¨å®ç°
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ agent.py            # ä¸» Agent é€»è¾‘ï¼Œæ•´åˆå·¥å…·
â”‚   â”œâ”€â”€ workflow/           # LangGraph èŠ‚ç‚¹å¤„ç†é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ graph.py        # æ£€ç´¢å·¥ä½œæµå›¾
â”‚   â”‚   â”œâ”€â”€ nodes.py        # å·¥ä½œæµèŠ‚ç‚¹å®ç°
â”‚   â”‚   â”œâ”€â”€ states.py       # å·¥ä½œæµçŠ¶æ€å®šä¹‰
â”‚   â”‚   â””â”€â”€ prompts.py      # æç¤ºè¯æ¨¡æ¿
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹å’Œæ¨¡å¼
â”‚   â”œâ”€â”€ tools/              # å·¥å…·æ¨¡å—ï¼ŒåŒ…æ‹¬æ£€ç´¢å™¨
â”‚   â”‚   â””â”€â”€ local_retriever.py # æœ¬åœ°æ£€ç´¢å·¥å…·
â”‚   â””â”€â”€ mcp_clients/        # MCP å®¢æˆ·ç«¯å®ç°
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â””â”€â”€ README.md               # æœ¬æ–‡ä»¶
```

## ğŸ”„ å·¥ä½œæµç¨‹

### ç´¢å¼•æ„å»ºæµç¨‹

åŸºäº `md2tree.py`ï¼Œç´¢å¼•æ„å»ºé‡‡ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ–‡æ¡£è§£æ**ï¼šè¯»å– Markdown æ–‡ä»¶ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå– H1-H6 æ ‡é¢˜åŠå…¶å†…å®¹ï¼Œæ„å»ºæ‰å¹³èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ”¯æŒä»£ç å—è¿‡æ»¤ã€‚
2. **æ ‘çŠ¶ç»“æ„æ„å»º**ï¼šä½¿ç”¨æ ˆç®—æ³•å°†æ‰å¹³èŠ‚ç‚¹è½¬æ¢ä¸ºåµŒå¥—æ ‘ç»“æ„ï¼Œä¿ç•™å±‚çº§å…³ç³»ã€‚
3. **å…ƒæ•°æ®ç”Ÿæˆ**ï¼šé€’å½’éå†æ ‘ï¼Œè‡ªåº•å‘ä¸Šä½¿ç”¨ LLM ç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„æ‘˜è¦ï¼ˆsummaryï¼‰å’Œå…³é”®è¯ï¼ˆkeywordsï¼‰ã€‚å­èŠ‚ç‚¹ä¿¡æ¯ç”¨äºå¢å¼ºçˆ¶èŠ‚ç‚¹å…ƒæ•°æ®ï¼Œå¹¶å‘å¤„ç†å¤šä¸ªèŠ‚ç‚¹ä»¥æé«˜æ•ˆç‡ã€‚
4. **å…¨å±€ç´¢å¼•ç”Ÿæˆ**ï¼šä¸ºæ¯ä¸ªæ–‡æ¡£ç”Ÿæˆå…¨å±€æ‘˜è¦å’Œå…³é”®è¯ï¼Œåˆ›å»ºæ–‡æ¡£çº§ç´¢å¼•ï¼ˆdoc_id, summary, keywordsï¼‰ã€‚
5. **å­˜å‚¨ä¿å­˜**ï¼šå°†å¯¼èˆªæ ‘å’ŒåŸå­çº§å†…å®¹åˆ†åˆ«å­˜å‚¨åœ¨ `doc_tree_store` å’Œ `node_content_store` ä¸­ã€‚

### Agent å›å¤ç”ŸæˆåŸç†

Agent åŸºäº LangChain çš„ `create_agent` æ¡†æ¶ï¼Œå®ç°å¤šå·¥å…·åä½œï¼š

- **å·¥å…·é›†æˆ**ï¼šæ•´åˆæœ¬åœ°æ£€ç´¢å·¥å…· `search_local_docs`ï¼ˆè°ƒç”¨ LangGraph å·¥ä½œæµè¿›è¡Œæ–‡æ¡£æ£€ç´¢ï¼‰å’Œå¤–éƒ¨ MCP å®¢æˆ·ç«¯å·¥å…·ï¼ˆæ”¯æŒåœ¨çº¿æ–‡æ¡£æŸ¥è¯¢ï¼‰ã€‚
- **æ¨ç†è¿‡ç¨‹**ï¼šæ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ï¼ŒAgent ä½¿ç”¨ LLM æ¨ç†å†³å®šè°ƒç”¨å“ªäº›å·¥å…·ã€‚æœ¬åœ°å·¥å…·æŸ¥è¯¢ç´¢å¼•åçš„æ–‡æ¡£ç‰‡æ®µï¼ŒMCP å·¥å…·æŸ¥è¯¢åœ¨çº¿èµ„æºã€‚
- **å›å¤åˆæˆ**ï¼šç»“åˆå·¥å…·è¿”å›çš„ç»“æœï¼ŒLLM ç”Ÿæˆè¿è´¯çš„è‡ªç„¶è¯­è¨€å›ç­”ï¼Œå®ç°æœ¬åœ°å’Œåœ¨çº¿æ–‡æ¡£çš„æ— ç¼èåˆã€‚

### èŠ‚ç‚¹ç´¢å¼• (Node Metadata)
æ¯ä¸ªèŠ‚ç‚¹åŒ…å«å…³é”®è¯ï¼Œå¯¹ä¿¡æ¯å¯†é›†çš„æŠ€æœ¯æ–‡æ¡£è‡³å…³é‡è¦ã€‚èŠ‚ç‚¹åœ¨æ„å»ºæ—¶ä¼šå‚è€ƒå­èŠ‚ç‚¹ä¿¡æ¯ï¼š

```json
{
  "node_id": "0006",
  "path": "backends > Backends > Built-in backends > StoreBackend (LangGraph Store)",
  "title": "StoreBackend (LangGraph Store)",
  "keywords": ["StoreBackend", "LangGraph Store", "InMemoryStore", "BaseStore", "deep agents", "cross-thread storage"],
  "summary": "Describes the configuration and usage of StoreBackend with LangGraph Store for durable cross-thread storage in deep agents.",
  "nodes": []
}
```

### æ–‡æ¡£æ ‘ï¼ˆDoc Treeï¼‰
æ¯ä¸ªæ–‡æ¡£æœ‰è‡ªå·±çš„ doc_idï¼Œå®ƒçš„æ ‘ä½œä¸ºä¸€ä¸ªå¯¼èˆªç›®å½•ä¾› LLM é˜…è¯»ï¼š

```json
{
  "doc_id": "doc_0001",
  "doc_name": "backends",
  "summary": "Configure and route filesystem backends for deep agents with policy enforcement, including built-in and custom options.",
  "keywords": ["filesystem backends", "deep agent", "CompositeBackend", "BackendProtocol", "policy hooks", "virtual filesystem"],
  "structure": [{"node_1": "node"}, {"node_2": "node"}]
}
```

### å…¨å±€ç´¢å¼•
æ¯ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®åˆ—è¡¨ (doc_id, summary, keywords)ï¼š

```json
[
  {
    "doc_id": "doc_0001",
    "doc_name": "backends",
    "keywords": ["filesystem backends", "deep agent", "CompositeBackend", "BackendProtocol", "policy hooks", "virtual filesystem"],
    "summary": "Configure and route filesystem backends for deep agents with policy enforcement, including built-in and custom options."
  }
]
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒäº† [pageIndex](https://github.com/VectifyAI/PageIndex) è¿›è¡Œæ–‡æ¡£å¯¼èˆªæ ‘æ„å»ºã€‚
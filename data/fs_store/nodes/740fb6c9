{"node_id": "740fb6c9", "title": "Delete messages", "path": "add-memory > Memory > Manage short-term memory > Delete messages", "content": "You can delete messages from the graph state to manage the message history. This is useful when you want to remove specific messages or clear the entire message history.\n\nTo delete messages from the graph state, you can use the `RemoveMessage`. For `RemoveMessage` to work, you need to use a state key with [`add_messages`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.message.add_messages) [reducer](/oss/python/langgraph/graph-api#reducers), like [`MessagesState`](/oss/python/langgraph/graph-api#messagesstate).\n\nTo remove specific messages:\n\n```python  theme={null}\nfrom langchain.messages import RemoveMessage  # [!code highlight]\n\ndef delete_messages(state):\n    messages = state[\"messages\"]\n    if len(messages) > 2:\n        # remove the earliest two messages\n        return {\"messages\": [RemoveMessage(id=m.id) for m in messages[:2]]}  # [!code highlight]\n```\n\nTo remove **all** messages:\n\n```python  theme={null}\nfrom langgraph.graph.message import REMOVE_ALL_MESSAGES  # [!code highlight]\n\ndef delete_messages(state):\n    return {\"messages\": [RemoveMessage(id=REMOVE_ALL_MESSAGES)]}  # [!code highlight]\n```\n\n<Warning>\n  When deleting messages, **make sure** that the resulting message history is valid. Check the limitations of the LLM provider you're using. For example:\n\n  * Some providers expect message history to start with a `user` message\n  * Most providers require `assistant` messages with tool calls to be followed by corresponding `tool` result messages.\n</Warning>\n\n<Accordion title=\"Full example: delete messages\">\n  ```python  theme={null}\n  from langchain.messages import RemoveMessage  # [!code highlight]\n\n  def delete_messages(state):\n      messages = state[\"messages\"]\n      if len(messages) > 2:\n          # remove the earliest two messages\n          return {\"messages\": [RemoveMessage(id=m.id) for m in messages[:2]]}  # [!code highlight]\n\n  def call_model(state: MessagesState):\n      response = model.invoke(state[\"messages\"])\n      return {\"messages\": response}\n\n  builder = StateGraph(MessagesState)\n  builder.add_sequence([call_model, delete_messages])\n  builder.add_edge(START, \"call_model\")\n\n  checkpointer = InMemorySaver()\n  app = builder.compile(checkpointer=checkpointer)\n\n  for event in app.stream(\n      {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n      config,\n      stream_mode=\"values\"\n  ):\n      print([(message.type, message.content) for message in event[\"messages\"]])\n\n  for event in app.stream(\n      {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n      config,\n      stream_mode=\"values\"\n  ):\n      print([(message.type, message.content) for message in event[\"messages\"]])\n  ```\n\n  ```\n  [('human', \"hi! I'm bob\")]\n  [('human', \"hi! I'm bob\"), ('ai', 'Hi Bob! How are you doing today? Is there anything I can help you with?')]\n  [('human', \"hi! I'm bob\"), ('ai', 'Hi Bob! How are you doing today? Is there anything I can help you with?'), ('human', \"what's my name?\")]\n  [('human', \"hi! I'm bob\"), ('ai', 'Hi Bob! How are you doing today? Is there anything I can help you with?'), ('human', \"what's my name?\"), ('ai', 'Your name is Bob.')]\n  [('human', \"what's my name?\"), ('ai', 'Your name is Bob.')]\n  ```\n</Accordion>", "summary": "Explains how to delete specific or all messages from a graph state using RemoveMessage and REMOVE_ALL_MESSAGES in LangGraph, with code examples and warnings about maintaining valid message history.", "keywords": ["RemoveMessage", "REMOVE_ALL_MESSAGES", "MessagesState", "add_messages", "reducer", "graph state", "message history", "LangGraph", "state key", "InMemorySaver"]}
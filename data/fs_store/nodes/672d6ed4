{"node_id": "672d6ed4", "title": "5. Rewrite question", "path": "agentic-rag > Build a custom RAG agent with LangGraph > 5. Rewrite question", "content": "1. Build the `rewrite_question` node. The retriever tool can return potentially irrelevant documents, which indicates a need to improve the original user question. To do so, we will call the `rewrite_question` node:\n\n```python  theme={null}\nfrom langchain.messages import HumanMessage\n\nREWRITE_PROMPT = (\n    \"Look at the input and try to reason about the underlying semantic intent / meaning.\\n\"\n    \"Here is the initial question:\"\n    \"\\n ------- \\n\"\n    \"{question}\"\n    \"\\n ------- \\n\"\n    \"Formulate an improved question:\"\n)\n\n\ndef rewrite_question(state: MessagesState):\n    \"\"\"Rewrite the original user question.\"\"\"\n    messages = state[\"messages\"]\n    question = messages[0].content\n    prompt = REWRITE_PROMPT.format(question=question)\n    response = response_model.invoke([{\"role\": \"user\", \"content\": prompt}])\n    return {\"messages\": [HumanMessage(content=response.content)]}\n```\n\n2. Try it out:\n\n```python  theme={null}\ninput = {\n    \"messages\": convert_to_messages(\n        [\n            {\n                \"role\": \"user\",\n                \"content\": \"What does Lilian Weng say about types of reward hacking?\",\n            },\n            {\n                \"role\": \"assistant\",\n                \"content\": \"\",\n                \"tool_calls\": [\n                    {\n                        \"id\": \"1\",\n                        \"name\": \"retrieve_blog_posts\",\n                        \"args\": {\"query\": \"types of reward hacking\"},\n                    }\n                ],\n            },\n            {\"role\": \"tool\", \"content\": \"meow\", \"tool_call_id\": \"1\"},\n        ]\n    )\n}\n\nresponse = rewrite_question(input)\nprint(response[\"messages\"][-1].content)\n```\n\n**Output:**\n\n```\nWhat are the different types of reward hacking described by Lilian Weng, and how does she explain them?\n```", "summary": "Defines a function to rewrite user questions for better retrieval by analyzing semantic intent and generating improved queries.", "keywords": ["rewrite_question", "LangGraph", "RAG", "retriever tool", "semantic intent", "HumanMessage", "prompt", "response_model", "reward hacking", "Lilian Weng"]}
{"node_id": "9d622f6d", "title": "Side effects called before `interrupt` must be idempotent", "path": "interrupts > Interrupts > Rules of interrupts > Side effects called before `interrupt` must be idempotent", "content": "Because interrupts work by re-running the nodes they were called from, side effects called before [`interrupt`](https://reference.langchain.com/python/langgraph/types/#langgraph.types.interrupt) should (ideally) be idempotent. For context, idempotency means that the same operation can be applied multiple times without changing the result beyond the initial execution.\n\nAs an example, you might have an API call to update a record inside of a node. If [`interrupt`](https://reference.langchain.com/python/langgraph/types/#langgraph.types.interrupt) is called after that call is made, it will be re-run multiple times when the node is resumed, potentially overwriting the initial update or creating duplicate records.\n\n* ‚úÖ Use idempotent operations before [`interrupt`](https://reference.langchain.com/python/langgraph/types/#langgraph.types.interrupt)\n* ‚úÖ Place side effects after [`interrupt`](https://reference.langchain.com/python/langgraph/types/#langgraph.types.interrupt) calls\n* ‚úÖ Separate side effects into separate nodes when possible\n\n<CodeGroup>\n  ```python Idempotent operations theme={null}\n  def node_a(state: State):\n      # ‚úÖ Good: using upsert operation which is idempotent\n      # Running this multiple times will have the same result\n      db.upsert_user(\n          user_id=state[\"user_id\"],\n          status=\"pending_approval\"\n      )\n\n      approved = interrupt(\"Approve this change?\")\n\n      return {\"approved\": approved}\n  ```\n\n  ```python Side effects after interrupt theme={null}\n  def node_a(state: State):\n      # ‚úÖ Good: placing side effect after the interrupt\n      # This ensures it only runs once after approval is received\n      approved = interrupt(\"Approve this change?\")\n\n      if approved:\n          db.create_audit_log(\n              user_id=state[\"user_id\"],\n              action=\"approved\"\n          )\n\n      return {\"approved\": approved}\n  ```\n\n  ```python Separating into different nodes theme={null}\n  def approval_node(state: State):\n      # ‚úÖ Good: only handling the interrupt in this node\n      approved = interrupt(\"Approve this change?\")\n\n      return {\"approved\": approved}\n\n  def notification_node(state: State):\n      # ‚úÖ Good: side effect happens in a separate node\n      # This runs after approval, so it only executes once\n      if (state.approved):\n          send_notification(\n              user_id=state[\"user_id\"],\n              status=\"approved\"\n          )\n\n      return state\n  ```\n</CodeGroup>\n\n* üî¥ Do not perform non-idempotent operations before [`interrupt`](https://reference.langchain.com/python/langgraph/types/#langgraph.types.interrupt)\n* üî¥ Do not create new records without checking if they exist\n\n<CodeGroup>\n  ```python Creating records theme={null}\n  def node_a(state: State):\n      # ‚ùå Bad: creating a new record before interrupt\n      # This will create duplicate records on each resume\n      audit_id = db.create_audit_log({\n          \"user_id\": state[\"user_id\"],\n          \"action\": \"pending_approval\",\n          \"timestamp\": datetime.now()\n      })\n\n      approved = interrupt(\"Approve this change?\")\n\n      return {\"approved\": approved, \"audit_id\": audit_id}\n  ```\n\n  ```python Appending to lists theme={null}\n  def node_a(state: State):\n      # ‚ùå Bad: appending to a list before interrupt\n      # This will add duplicate entries on each resume\n      db.append_to_history(state[\"user_id\"], \"approval_requested\")\n\n      approved = interrupt(\"Approve this change?\")\n\n      return {\"approved\": approved}\n  ```\n</CodeGroup>", "summary": "Side effects before `interrupt` must be idempotent to prevent duplicate operations when nodes are re-run, with best practices and code examples provided.", "keywords": ["interrupt", "idempotent", "side effects", "LangGraph", "node", "API call", "upsert", "audit log", "resume", "duplicate records"]}
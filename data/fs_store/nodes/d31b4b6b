{"node_id": "d31b4b6b", "title": "Use in production", "path": "add-memory > Memory > Add short-term memory > Use in production", "content": "In production, use a checkpointer backed by a database:\n\n```python  theme={null}\nfrom langgraph.checkpoint.postgres import PostgresSaver\n\nDB_URI = \"postgresql://postgres:postgres@localhost:5442/postgres?sslmode=disable\"\nwith PostgresSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n    builder = StateGraph(...)\n    graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n```\n\n<Accordion title=\"Example: using Postgres checkpointer\">\n  ```\n  pip install -U \"psycopg[binary,pool]\" langgraph langgraph-checkpoint-postgres\n  ```\n\n  <Tip>\n    You need to call `checkpointer.setup()` the first time you're using Postgres checkpointer\n  </Tip>\n\n  <Tabs>\n    <Tab title=\"Sync\">\n      ```python  theme={null}\n      from langchain.chat_models import init_chat_model\n      from langgraph.graph import StateGraph, MessagesState, START\n      from langgraph.checkpoint.postgres import PostgresSaver  # [!code highlight]\n\n      model = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\n      DB_URI = \"postgresql://postgres:postgres@localhost:5442/postgres?sslmode=disable\"\n      with PostgresSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n          # checkpointer.setup()\n\n          def call_model(state: MessagesState):\n              response = model.invoke(state[\"messages\"])\n              return {\"messages\": response}\n\n          builder = StateGraph(MessagesState)\n          builder.add_node(call_model)\n          builder.add_edge(START, \"call_model\")\n\n          graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n\n          config = {\n              \"configurable\": {\n                  \"thread_id\": \"1\"  # [!code highlight]\n              }\n          }\n\n          for chunk in graph.stream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n\n          for chunk in graph.stream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n      ```\n    </Tab>\n\n    <Tab title=\"Async\">\n      ```python  theme={null}\n      from langchain.chat_models import init_chat_model\n      from langgraph.graph import StateGraph, MessagesState, START\n      from langgraph.checkpoint.postgres.aio import AsyncPostgresSaver  # [!code highlight]\n\n      model = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\n      DB_URI = \"postgresql://postgres:postgres@localhost:5442/postgres?sslmode=disable\"\n      async with AsyncPostgresSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n          # await checkpointer.setup()\n\n          async def call_model(state: MessagesState):\n              response = await model.ainvoke(state[\"messages\"])\n              return {\"messages\": response}\n\n          builder = StateGraph(MessagesState)\n          builder.add_node(call_model)\n          builder.add_edge(START, \"call_model\")\n\n          graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n\n          config = {\n              \"configurable\": {\n                  \"thread_id\": \"1\"  # [!code highlight]\n              }\n          }\n\n          async for chunk in graph.astream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n\n          async for chunk in graph.astream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n      ```\n    </Tab>\n  </Tabs>\n</Accordion>\n\n<Accordion title=\"Example: using MongoDB checkpointer\">\n  ```\n  pip install -U pymongo langgraph langgraph-checkpoint-mongodb\n  ```\n\n  <Note>\n    **Setup**\n    To use the [MongoDB checkpointer](https://pypi.org/project/langgraph-checkpoint-mongodb/), you will need a MongoDB cluster. Follow [this guide](https://www.mongodb.com/docs/guides/atlas/cluster/) to create a cluster if you don't already have one.\n  </Note>\n\n  <Tabs>\n    <Tab title=\"Sync\">\n      ```python  theme={null}\n      from langchain.chat_models import init_chat_model\n      from langgraph.graph import StateGraph, MessagesState, START\n      from langgraph.checkpoint.mongodb import MongoDBSaver  # [!code highlight]\n\n      model = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\n      DB_URI = \"localhost:27017\"\n      with MongoDBSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n\n          def call_model(state: MessagesState):\n              response = model.invoke(state[\"messages\"])\n              return {\"messages\": response}\n\n          builder = StateGraph(MessagesState)\n          builder.add_node(call_model)\n          builder.add_edge(START, \"call_model\")\n\n          graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n\n          config = {\n              \"configurable\": {\n                  \"thread_id\": \"1\"  # [!code highlight]\n              }\n          }\n\n          for chunk in graph.stream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n\n          for chunk in graph.stream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n      ```\n    </Tab>\n\n    <Tab title=\"Async\">\n      ```python  theme={null}\n      from langchain.chat_models import init_chat_model\n      from langgraph.graph import StateGraph, MessagesState, START\n      from langgraph.checkpoint.mongodb.aio import AsyncMongoDBSaver  # [!code highlight]\n\n      model = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\n      DB_URI = \"localhost:27017\"\n      async with AsyncMongoDBSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n\n          async def call_model(state: MessagesState):\n              response = await model.ainvoke(state[\"messages\"])\n              return {\"messages\": response}\n\n          builder = StateGraph(MessagesState)\n          builder.add_node(call_model)\n          builder.add_edge(START, \"call_model\")\n\n          graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n\n          config = {\n              \"configurable\": {\n                  \"thread_id\": \"1\"  # [!code highlight]\n              }\n          }\n\n          async for chunk in graph.astream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n\n          async for chunk in graph.astream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n      ```\n    </Tab>\n  </Tabs>\n</Accordion>\n\n<Accordion title=\"Example: using Redis checkpointer\">\n  ```\n  pip install -U langgraph langgraph-checkpoint-redis\n  ```\n\n  <Tip>\n    You need to call `checkpointer.setup()` the first time you're using Redis checkpointer.\n  </Tip>\n\n  <Tabs>\n    <Tab title=\"Sync\">\n      ```python  theme={null}\n      from langchain.chat_models import init_chat_model\n      from langgraph.graph import StateGraph, MessagesState, START\n      from langgraph.checkpoint.redis import RedisSaver  # [!code highlight]\n\n      model = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\n      DB_URI = \"redis://localhost:6379\"\n      with RedisSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n          # checkpointer.setup()\n\n          def call_model(state: MessagesState):\n              response = model.invoke(state[\"messages\"])\n              return {\"messages\": response}\n\n          builder = StateGraph(MessagesState)\n          builder.add_node(call_model)\n          builder.add_edge(START, \"call_model\")\n\n          graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n\n          config = {\n              \"configurable\": {\n                  \"thread_id\": \"1\"  # [!code highlight]\n              }\n          }\n\n          for chunk in graph.stream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n\n          for chunk in graph.stream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n      ```\n    </Tab>\n\n    <Tab title=\"Async\">\n      ```python  theme={null}\n      from langchain.chat_models import init_chat_model\n      from langgraph.graph import StateGraph, MessagesState, START\n      from langgraph.checkpoint.redis.aio import AsyncRedisSaver  # [!code highlight]\n\n      model = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\n      DB_URI = \"redis://localhost:6379\"\n      async with AsyncRedisSaver.from_conn_string(DB_URI) as checkpointer:  # [!code highlight]\n          # await checkpointer.asetup()\n\n          async def call_model(state: MessagesState):\n              response = await model.ainvoke(state[\"messages\"])\n              return {\"messages\": response}\n\n          builder = StateGraph(MessagesState)\n          builder.add_node(call_model)\n          builder.add_edge(START, \"call_model\")\n\n          graph = builder.compile(checkpointer=checkpointer)  # [!code highlight]\n\n          config = {\n              \"configurable\": {\n                  \"thread_id\": \"1\"  # [!code highlight]\n              }\n          }\n\n          async for chunk in graph.astream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"hi! I'm bob\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n\n          async for chunk in graph.astream(\n              {\"messages\": [{\"role\": \"user\", \"content\": \"what's my name?\"}]},\n              config,  # [!code highlight]\n              stream_mode=\"values\"\n          ):\n              chunk[\"messages\"][-1].pretty_print()\n      ```\n    </Tab>\n  </Tabs>\n</Accordion>", "summary": "Demonstrates using database-backed checkpoints (Postgres, MongoDB, Redis) in production for LangGraph state persistence, with sync/async code examples.", "keywords": ["PostgresSaver", "MongoDBSaver", "RedisSaver", "checkpointer", "StateGraph", "thread_id", "MessagesState", "from_conn_string", "setup", "compile"]}